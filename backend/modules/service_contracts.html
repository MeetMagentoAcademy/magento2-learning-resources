
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>APIs Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../performance.html" />
    
    
    <link rel="prev" href="database.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">1. Sysops</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../sysops/part1.html">
            
                <a href="../../sysops/part1.html">
            
                    
                    Part 1 - Virtual machine
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../sysops/part2.html">
            
                <a href="../../sysops/part2.html">
            
                    
                    Part 2 - Configuring network for VM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../sysops/part3.html">
            
                <a href="../../sysops/part3.html">
            
                    
                    Part 3 - Dedicated user for Magento processes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../../sysops/part4.html">
            
                <a href="../../sysops/part4.html">
            
                    
                    Part 4 - Debian repositories
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../../sysops/part5.html">
            
                <a href="../../sysops/part5.html">
            
                    
                    Part 5 - MySQL installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../../sysops/part6.html">
            
                <a href="../../sysops/part6.html">
            
                    
                    Part 6 - PHP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="../../sysops/part7.html">
            
                <a href="../../sysops/part7.html">
            
                    
                    Part 7 - Web server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="../../sysops/part8.html">
            
                <a href="../../sysops/part8.html">
            
                    
                    Part 8 - Two Redis instances
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="../../sysops/part9.html">
            
                <a href="../../sysops/part9.html">
            
                    
                    Part 9 - Code deployment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.10" data-path="../../sysops/part10.html">
            
                <a href="../../sysops/part10.html">
            
                    
                    Part 10 - Cron jobs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.11" data-path="../../sysops/AUTHORS.html">
            
                <a href="../../sysops/AUTHORS.html">
            
                    
                    Authors
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">2. Administration</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../administration/part1.html">
            
                <a href="../../administration/part1.html">
            
                    
                    Part 1 - Basic store configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../administration/part2.html">
            
                <a href="../../administration/part2.html">
            
                    
                    Part 2 - Creating catalog - products
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../../administration/part3.html">
            
                <a href="../../administration/part3.html">
            
                    
                    Part 3 - Creating catalog - attributes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../../administration/part4.html">
            
                <a href="../../administration/part4.html">
            
                    
                    Part 4 - Creating catalog - categories
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../../administration/part5.html">
            
                <a href="../../administration/part5.html">
            
                    
                    Part 5 - Marketing - Catalog price rules 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../../administration/part6.html">
            
                <a href="../../administration/part6.html">
            
                    
                    Part 6 - Marketing - Cart price rules 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="../../administration/part7.html">
            
                <a href="../../administration/part7.html">
            
                    
                    Part 7 - Marketing - Customers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="../../administration/part8.html">
            
                <a href="../../administration/part8.html">
            
                    
                    Part 8 - Marketing - Email templates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="../../administration/part9.html">
            
                <a href="../../administration/part9.html">
            
                    
                    Part 9 - Orders management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.10" data-path="../../administration/part10.html">
            
                <a href="../../administration/part10.html">
            
                    
                    Part 10 - Payments Methods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11" data-path="../../administration/part11.html">
            
                <a href="../../administration/part11.html">
            
                    
                    Part 11 - Shipping methods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.12" data-path="../../administration/part12.html">
            
                <a href="../../administration/part12.html">
            
                    
                    Part 12 - Store Setting Conf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.13" data-path="../../administration/part13.html">
            
                <a href="../../administration/part13.html">
            
                    
                    Part 13 - Export/Import products
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.14" data-path="../../administration/part14.html">
            
                <a href="../../administration/part14.html">
            
                    
                    Part 14 - Reports
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.15" data-path="../../administration/part15.html">
            
                <a href="../../administration/part15.html">
            
                    
                    Contact/ Q&A
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">3. Backend</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../modules.html">
            
                <a href="../modules.html">
            
                    
                    Modules
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="create.html">
            
                <a href="create.html">
            
                    
                    Creating modules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="controller.html">
            
                <a href="controller.html">
            
                    
                    Defining controllers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="layout.html">
            
                <a href="layout.html">
            
                    
                    Rendering page layout
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="translations.html">
            
                <a href="translations.html">
            
                    
                    Translations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5" data-path="store_configuration.html">
            
                <a href="store_configuration.html">
            
                    
                    Store configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.6" data-path="flash_message.html">
            
                <a href="flash_message.html">
            
                    
                    Flash message
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.7" data-path="database.html">
            
                <a href="database.html">
            
                    
                    Acessing databade
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="4.1.8" data-path="service_contracts.html">
            
                <a href="service_contracts.html">
            
                    
                    APIs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../performance.html">
            
                <a href="../performance.html">
            
                    
                    Performance
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="../performance/profiler.html">
            
                <a href="../performance/profiler.html">
            
                    
                    Profiler
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="../performance/eav.html">
            
                <a href="../performance/eav.html">
            
                    
                    EAV explained
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../di.html">
            
                <a href="../di.html">
            
                    
                    Dependency Injection
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">4. Frontend</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../../frontend/themes/overview.html">
            
                <a href="../../frontend/themes/overview.html">
            
                    
                    Themes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1" data-path="../../frontend/themes/structure.html">
            
                <a href="../../frontend/themes/structure.html">
            
                    
                    Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2" data-path="../../frontend/themes/inheritance.html">
            
                <a href="../../frontend/themes/inheritance.html">
            
                    
                    Inheritance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3" data-path="../../frontend/themes/debug.html">
            
                <a href="../../frontend/themes/debug.html">
            
                    
                    Debuging
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../../frontend/layout/overview.html">
            
                <a href="../../frontend/layout/overview.html">
            
                    
                    Layout
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.2.1" data-path="../../frontend/layout/types.html">
            
                <a href="../../frontend/layout/types.html">
            
                    
                    Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2.2" data-path="../../frontend/layout/examples.html">
            
                <a href="../../frontend/layout/examples.html">
            
                    
                    Examples
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../../frontend/templates/overview.html">
            
                <a href="../../frontend/templates/overview.html">
            
                    
                    Templates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="../../frontend/styles/overview.html">
            
                <a href="../../frontend/styles/overview.html">
            
                    
                    Styles
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.4.1" data-path="../../frontend/styles/grunt.html">
            
                <a href="../../frontend/styles/grunt.html">
            
                    
                    Grunt
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4.2" data-path="../../frontend/styles/sass.html">
            
                <a href="../../frontend/styles/sass.html">
            
                    
                    SASS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4.3" data-path="../../frontend/styles/magento-ui.html">
            
                <a href="../../frontend/styles/magento-ui.html">
            
                    
                    Magento UI
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="../../frontend/javascript/overview.html">
            
                <a href="../../frontend/javascript/overview.html">
            
                    
                    JavaScript
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.5.1" data-path="../../frontend/javascript/requirejs.html">
            
                <a href="../../frontend/javascript/requirejs.html">
            
                    
                    Require.js
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5.2" data-path="../../frontend/javascript/using-amd.html">
            
                <a href="../../frontend/javascript/using-amd.html">
            
                    
                    AMD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5.3" data-path="../../frontend/javascript/custom.html">
            
                <a href="../../frontend/javascript/custom.html">
            
                    
                    Custom modules
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >APIs</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="apis-and-service-contracts">APIs and Service Contracts</h1>
<p>Magento is highly modular software and often to achieve some functionality multiple modules need to be involved.
In order to decrease relying on specific implementations of such modules service contracts were introduced in Magento 2.</p>
<p>Service contracts are expressed as PHP interfaces that can be depend upon.
This way implementations can be swapped easily as long as they do not brake service contract.
This allows module creators to offer different implementations of base modules that offer different performance - often used example is storing product data in MongoDB instead of MySQL compatible database or using search engines like Apache Solr or ElasticSearch to implement better catalog search experience.</p>
<p>All module functionality that could be accessed by other modules (or even external systems) should be exposed as service contract.
Service contracts should be defined within <code>Api</code> directory so they could be easily located by other developers.
Take note that data structures used by those service contracts should be service contracts as well - we define them in <code>Api/Data</code> directory and since those are &quot;data contracts&quot; they expose only getters and setters.</p>
<h2 id="service-contract-example">Service Contract Example</h2>
<p>First example is our data service contract.
It will provide exactly the same structure as our database table (note that we do not allow to set creation date or internal ID as this should not change).</p>
<p>Apart of getters and setters it is good idea to define constants that will represent column names in database for future use in our code internals.</p>
<pre><code class="lang-php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">namespace</span> <span class="hljs-title">MMAcademy</span>\<span class="hljs-title">MicroReview</span>\<span class="hljs-title">Api</span>\<span class="hljs-title">Data</span>;

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ReviewInterface</span>
</span>{
    <span class="hljs-keyword">const</span> REVIEW_ID = <span class="hljs-string">&apos;review_id&apos;</span>;
    <span class="hljs-keyword">const</span> PRODUCT_ID = <span class="hljs-string">&apos;product_id&apos;</span>;
    <span class="hljs-keyword">const</span> MESSAGE = <span class="hljs-string">&apos;message&apos;</span>;
    <span class="hljs-keyword">const</span> CREATED_AT = <span class="hljs-string">&apos;created_at&apos;</span>;

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@return</span> int
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getReviewId</span><span class="hljs-params">()</span></span>;

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@return</span> int
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getProductId</span><span class="hljs-params">()</span></span>;

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> int $productId
     * <span class="hljs-doctag">@return</span> self
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setProductId</span><span class="hljs-params">($productId)</span></span>;

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@return</span> string
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getMessage</span><span class="hljs-params">()</span></span>;

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> string $message
     * <span class="hljs-doctag">@return</span> self
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setMessage</span><span class="hljs-params">($message)</span></span>;

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@return</span> string
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCreatedAt</span><span class="hljs-params">()</span></span>;
}
</code></pre>
<p>In this example we will define three simple methods:</p>
<ul>
<li><code>add</code> to create new reviews based on product ID and review body</li>
<li><code>delete</code> to allow removal of reviews</li>
<li><code>getRecent</code> to access five most recent reviews </li>
</ul>
<blockquote>
<p>Note that we did not import any namespaces using <code>use</code> operator here in order to simply documentation comments.
PHP can access documentation comments using reflection mechanism and read them as string.
This allows Magento to parse those comments - later on we can expose service contracts as SOAP or REST webservices and annotations like <code>@param</code> or <code>@return</code> will be used to describe those services.
Do not use <code>use</code> operator in service contracts because those will not be available to Magento when parsing docblocks leading to problems with exposing new API (Magento will not be able to find proper type of argument or return type)</p>
</blockquote>
<pre><code class="lang-php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">namespace</span> <span class="hljs-title">MMAcademy</span>\<span class="hljs-title">MicroReview</span>\<span class="hljs-title">Api</span>;

<span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ReviewRepositoryInterface</span>
</span>{
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> int $productId
     * <span class="hljs-doctag">@param</span> string $message
     * <span class="hljs-doctag">@return</span> boolean
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span><span class="hljs-params">($productId, $message)</span></span>;

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> int $reviewId
     * <span class="hljs-doctag">@return</span> boolean
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">delete</span><span class="hljs-params">($reviewId)</span></span>;

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@return</span> \MMAcademy\MicroReview\Api\Data\ReviewInterface[]
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getRecent</span><span class="hljs-params">()</span></span>;
}
</code></pre>
<h2 id="service-contract-implementation">Service Contract Implementation</h2>
<p>Obvious implementation of our data service contract is our model that is already capable of holding review data.
In order to be fully compliant with interface we have to explicitly implement all getters and setters, but our model already had methods to access any data - <code>getData($attribute)</code> and <code>setData($attribute, $value)</code> methods.
Here we can also use previously declared constants.</p>
<p>In order to propagate creation date into our object we have overloaded <code>beforeSave</code> method - it is called automatically by resource model before persiting object in database.</p>
<pre><code class="lang-php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">namespace</span> <span class="hljs-title">MMAcademy</span>\<span class="hljs-title">MicroReview</span>\<span class="hljs-title">Model</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">Magento</span>\<span class="hljs-title">Framework</span>\<span class="hljs-title">Model</span>\<span class="hljs-title">AbstractModel</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">MMAcademy</span>\<span class="hljs-title">MicroReview</span>\<span class="hljs-title">Api</span>\<span class="hljs-title">Data</span>\<span class="hljs-title">ReviewInterface</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Review</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractModel</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ReviewInterface</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getReviewId</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> $this-&gt;getData(ReviewInterface::REVIEW_ID);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getProductId</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> $this-&gt;getData(ReviewInterface::PRODUCT_ID);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setProductId</span><span class="hljs-params">($productId)</span>
    </span>{
        $this-&gt;setData(ReviewInterface::PRODUCT_ID, $productId);

        <span class="hljs-keyword">return</span> $this;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getMessage</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> $this-&gt;getData(ReviewInterface::MESSAGE);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setMessage</span><span class="hljs-params">($message)</span>
    </span>{
        $this-&gt;setData(ReviewInterface::MESSAGE, $message);

        <span class="hljs-keyword">return</span> $this;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCreatedAt</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> $this-&gt;getData(ReviewInterface::CREATED_AT);
    }

    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_construct</span><span class="hljs-params">()</span>
    </span>{
        $this-&gt;_init(ResourceModel\Review::class);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">beforeSave</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">parent</span>::beforeSave();
        <span class="hljs-keyword">if</span> ($this-&gt;isObjectNew()) {
            $this-&gt;setData(ReviewInterface::CREATED_AT, time());
        }

        <span class="hljs-keyword">return</span> $this;
    }
}
</code></pre>
<p>With implementation of review repository our first step is require using constructor dependency injection factory objects related to our model and collection.
Note that we never implemented such classes - Magento will autogenerate factory classes for You.
Use of factory class in this place is important because we will operate on object that have their state tied to database entry, but all classes injected via constructor dependency are singletons (You can configure an exception, but this will be less readable solution).
Autogenerated factory classes will have <code>create</code> method that will return new instance of given class.</p>
<p>Underlying implementations are quite easy and straigh forward.</p>
<p>For new review creation we create new instance of review object, assign it all required information and persist it using it&apos;s resource model.</p>
<p>For deletion we acquire new instance of review object, load it from database to ensure it exists and then use resource model to delete it from database.</p>
<p>With recent reviews we acquire new instance of collection object.
Then we have to apply on it our filters, in this case it is only sort order and limiting number of results to five.
But we could use methods like <code>addFieldToFilter</code> to pass more complicated constraints.
As soon as we call <code>getItems</code> all constraints are gathered, database query is composed and executed.</p>
<pre><code class="lang-php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">namespace</span> <span class="hljs-title">MMAcademy</span>\<span class="hljs-title">MicroReview</span>\<span class="hljs-title">Model</span>\<span class="hljs-title">ResourceModel</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">MMAcademy</span>\<span class="hljs-title">MicroReview</span>\<span class="hljs-title">Api</span>\<span class="hljs-title">Data</span>\<span class="hljs-title">ReviewInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">MMAcademy</span>\<span class="hljs-title">MicroReview</span>\<span class="hljs-title">Api</span>\<span class="hljs-title">ReviewRepositoryInterface</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">MMAcademy</span>\<span class="hljs-title">MicroReview</span>\<span class="hljs-title">Model</span>\<span class="hljs-title">ResourceModel</span>\<span class="hljs-title">Review</span>\<span class="hljs-title">Collection</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">MMAcademy</span>\<span class="hljs-title">MicroReview</span>\<span class="hljs-title">Model</span>\<span class="hljs-title">ResourceModel</span>\<span class="hljs-title">Review</span>\<span class="hljs-title">CollectionFactory</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">MMAcademy</span>\<span class="hljs-title">MicroReview</span>\<span class="hljs-title">Model</span>\<span class="hljs-title">Review</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">MMAcademy</span>\<span class="hljs-title">MicroReview</span>\<span class="hljs-title">Model</span>\<span class="hljs-title">ReviewFactory</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReviewRepository</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ReviewRepositoryInterface</span>
</span>{
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@var</span> ReviewFactory
     */</span>
    <span class="hljs-keyword">private</span> $reviewFactory;
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@var</span> CollectionFactory
     */</span>
    <span class="hljs-keyword">private</span> $collectionFactory;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(ReviewFactory $reviewFactory, CollectionFactory $collectionFactory)</span>
    </span>{
        $this-&gt;reviewFactory = $reviewFactory;
        $this-&gt;collectionFactory = $collectionFactory;
    }

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> int    $productId
     * <span class="hljs-doctag">@param</span> string $message
     * <span class="hljs-doctag">@return</span> boolean
     * <span class="hljs-doctag">@throws</span> \Exception
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span><span class="hljs-params">($productId, $message)</span>
    </span>{
        <span class="hljs-comment">/** <span class="hljs-doctag">@var</span> Review $review */</span>
        $review = $this-&gt;reviewFactory-&gt;create();
        $review-&gt;setMessage($message);
        $review-&gt;setProductId($productId);
        $review-&gt;getResource()-&gt;save($review);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> int $reviewId
     * <span class="hljs-doctag">@return</span> boolean
     * <span class="hljs-doctag">@throws</span> \Exception
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">delete</span><span class="hljs-params">($reviewId)</span>
    </span>{
        <span class="hljs-comment">/** <span class="hljs-doctag">@var</span> Review $review */</span>
        $review = $this-&gt;reviewFactory-&gt;create();
        $review-&gt;getResource()-&gt;load($review, $reviewId);
        $review-&gt;getResource()-&gt;delete($review);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }

    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@return</span> \MMAcademy\MicroReview\Api\Data\ReviewInterface[]
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getRecent</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">/** <span class="hljs-doctag">@var</span> Collection $collection */</span>
        $collection = $this-&gt;collectionFactory-&gt;create();
        $collection-&gt;setOrder(ReviewInterface::CREATED_AT);
        $collection-&gt;setPageSize(<span class="hljs-number">5</span>);

        <span class="hljs-keyword">return</span> $collection-&gt;getItems();
    }
}
</code></pre>
<p>Final step is to register our implementations as proper implementations of our service contract.
In order to do so we need to create file <code>etc/di.xml</code> with following content.</p>
<p>Note that preference node for given service contract could be defined in multiple modules.
Definition provided in last loaded module will be used (this is how we swap service contract implementation without altering other modules).</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span><span class="hljs-meta">?&gt;</span></span>

<span class="hljs-tag">&lt;<span class="hljs-name">config</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="hljs-attr">xsi:noNamespaceSchemaLocation</span>=<span class="hljs-string">&quot;urn:magento:framework:ObjectManager/etc/config.xsd&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">preference</span>
            <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;MMAcademy\MicroReview\Api\ReviewRepositoryInterface&quot;</span>
            <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;MMAcademy\MicroReview\Model\ResourceModel\ReviewRepository&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">preference</span>
            <span class="hljs-attr">for</span>=<span class="hljs-string">&quot;MMAcademy\MicroReview\Api\Data\ReviewInterface&quot;</span>
            <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;MMAcademy\MicroReview\Model\Review&quot;</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">config</span>&gt;</span>
</code></pre>
<h2 id="exposing-service-contracts-as-soaprest-apis">Exposing service contracts as SOAP/REST APIs</h2>
<p>As stated before service contracts can be exposed as SOAP or REST APIs very easily.
In order to do so we only need to assign RESTful request paths to proper methods in <code>etc/webapi.xml</code> file.</p>
<p>In this example we exposed all methods of our service contracts.
In order to simply this example we left them accessible for everyone (by assigning them resource <code>anonymous</code>), but there are methods for fine controlling access to specific methods.</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">routes</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
        <span class="hljs-attr">xsi:noNamespaceSchemaLocation</span>=<span class="hljs-string">&quot;urn:magento:module:Magento_Webapi:etc/webapi.xsd&quot;</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">route</span> <span class="hljs-attr">url</span>=<span class="hljs-string">&quot;/V1/micro_review&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;PUT&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;MMAcademy\MicroReview\Api\ReviewRepositoryInterface&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;add&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">resource</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;anonymous&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">route</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">route</span> <span class="hljs-attr">url</span>=<span class="hljs-string">&quot;/V1/micro_review/recent&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;GET&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;MMAcademy\MicroReview\Api\ReviewRepositoryInterface&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;getRecent&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">resource</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;anonymous&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">route</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">route</span> <span class="hljs-attr">url</span>=<span class="hljs-string">&quot;/V1/micro_review/:reviewId&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;DELETE&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;MMAcademy\MicroReview\Api\ReviewRepositoryInterface&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;delete&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">resource</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;anonymous&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">route</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">routes</span>&gt;</span>
</code></pre>
<p>Magento comes bundled with Swagger UI - REST API visualisation tool.
We can use it to see all REST API endpoint end even more - execute them!
Go to <code>/swagger</code> page of Your magento store.
If You search by <code>review</code> You should find <code>mMAcademyMicroReviewReviewRepositoryV1</code> service.
You can see there all methods exposed by this service contract and execute them by pressing &quot;Try it out!&quot;.
This will show You request target, body, response and even <code>curl</code> call example that will execute the same request.</p>
<p>If You want to access SOAP API name of service we found will be required.
Because there are a lot of services that are exposed one WSDL file to describe them all would be gigantic.
To avoid problems with big WSDL files we can specify what services we need when requesting WSDL file.
Now try to download WSDL file prom Your magento store installation at <code>/soap?services=mMAcademyMicroReviewReviewRepositoryV1&amp;wsdl</code>.
(You can specify more than one service by just separating their names with comma)</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="database.html" class="navigation navigation-prev " aria-label="Previous page: Acessing databade">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../performance.html" class="navigation navigation-next " aria-label="Next page: Performance">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"APIs","level":"4.1.8","depth":2,"next":{"title":"Performance","level":"4.2","depth":1,"path":"backend/performance.md","ref":"backend/performance.md","articles":[{"title":"Profiler","level":"4.2.1","depth":2,"path":"backend/performance/profiler.md","ref":"backend/performance/profiler.md","articles":[]},{"title":"EAV explained","level":"4.2.2","depth":2,"path":"backend/performance/eav.md","ref":"backend/performance/eav.md","articles":[]}]},"previous":{"title":"Acessing databade","level":"4.1.7","depth":2,"path":"backend/modules/database.md","ref":"backend/modules/database.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"backend/modules/service_contracts.md","mtime":"2018-01-15T09:27:58.963Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-01-15T09:30:14.962Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

